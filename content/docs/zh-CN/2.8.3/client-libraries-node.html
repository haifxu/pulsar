<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The Pulsar Node.js client · Apache Pulsar</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar [producer](#producers)、[consumer](#consumers) 和 [reader](#readers)。"/><meta name="docsearch:version" content="2.8.3"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="The Pulsar Node.js client · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.apache.org/"/><meta property="og:description" content="Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar [producer](#producers)、[consumer](#consumers) 和 [reader](#readers)。"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/zh-CN/versions"><h3>2.8.3</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/2.8.3/standalone" target="_self">文档</a></li><li class=""><a href="/zh-CN/download" target="_self">下载</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/2.8.3/client-libraries" target="_self">客户端</a></li><li class=""><a href="#restapis" target="_self">REST API</a></li><li class=""><a href="#cli" target="_self">命令行</a></li><li class=""><a href="/blog/" target="_self">博客</a></li><li class=""><a href="#community" target="_self">社区</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><li class=""><a href="https://pulsar-next.staged.apache.org/" target="_self">New Website(Beta)</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/2.8.3/client-libraries-node">English</a></li><li><a href="/docs/ja/2.8.3/client-libraries-node">日本語</a></li><li><a href="/docs/fr/2.8.3/client-libraries-node">Français</a></li><li><a href="/docs/ko/2.8.3/client-libraries-node">한국어</a></li><li><a href="/docs/zh-TW/2.8.3/client-libraries-node">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>客户端库</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/standalone">Run Pulsar locally</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/standalone-docker">Run Pulsar in Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/kubernetes-helm">Run Pulsar in Kubernetes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">概念和架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-messaging">Messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-architecture-overview">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-clients">Clients</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-replication">Geo Replication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-multi-tenancy">Multi Tenancy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-authentication">Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-topic-compaction">Topic Compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-proxy-sni-routing">Proxy support with SNI routing</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/concepts-multiple-advertised-listeners">Multiple advertised listeners</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/schema-get-started">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/schema-understand">Understand schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/schema-evolution-compatibility">Schema evolution and compatibility</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/schema-manage">Manage schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-runtime">Setup: Configure Functions runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-develop">How-to: Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-package">How-to: Package</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-debug">How-to: Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-deploy">How-to: Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/functions-cli">Reference: CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/window-functions-context">Window Functions: Context</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-quickstart">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-use">Use</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-connectors">Built-in connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-cdc">CDC connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-develop">Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/sql-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/sql-getting-started">Query data</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/sql-deployment-configurations">Configuration and deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/sql-rest-api">REST APIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">层级存储</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-aws">AWS S3 offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-gcs">GCS offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-filesystem">Filesystem offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-azure">Azure BlobStore offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/tiered-storage-aliyun">Aliyun OSS offloader</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">事务</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/txn-why">Why transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/txn-what">What are transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/txn-how">How transactions work?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/txn-use">How to use transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/txn-monitor">How to monitor transactions?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Kubernetes (Helm)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-prepare">Prepare</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-install">Install</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-deploy">Deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/helm-tools">Required Tools</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">部署</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-aws">Amazon Web Services</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-bare-metal">Bare metal</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-bare-metal-multi-cluster">Bare metal multi-cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/deploy-monitoring">Monitor</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">系统管理</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-geo">Geo-replication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-stats">Pulsar statistics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-load-balance">Load balance</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-proxy">Pulsar proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/administration-isolation">Pulsar isolation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">安全</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-tls-transport">Transport Encryption using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-tls-authentication">Authentication using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-jwt">Authentication using JWT</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-athenz">Authentication using Athenz</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-kerberos">Authentication using Kerberos</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-oauth2">Authentication using OAuth 2.0 access tokens</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-authorization">Authorization and ACLs</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-encryption">End-to-End Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-extending">Extending</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">性能</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/performance-pulsar-perf">Pulsar Perf</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端库</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-cpp">C++</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-node">Node.js</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-websocket">WebSocket</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/client-libraries-dotnet">C#</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-clusters">Clusters</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-tenants">Tenants</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-namespaces">Namespaces</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-topics">Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-functions">Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/admin-api-packages">Packages</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">适配器</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/adaptors-kafka">Kafka client wrapper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考手册</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-deduplication">Message deduplication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-non-persistent">Non-persistent messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-retention-expiry">Message retention and expiry</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-message-queue">Message queue</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/develop-tools">Simulation tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/develop-binary-protocol">Binary protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/develop-schema">Custom schema storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/develop-load-manager">Modular load manager</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/reference-terminology">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/reference-cli-tools">Pulsar CLI tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/2.8.3/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">The Pulsar Node.js client</h1></header><article><div><span><p>Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar <a href="#producers">producer</a>、<a href="#consumers">consumer</a> 和 <a href="#readers">reader</a>。</p>
<p>Node.js 客户端中 <a href="#producers">producer</a>、<a href="#consumers">consumer</a> 和 <a href="#readers">reader</a> 中的所有方法都对线程可用。</p>
<p>对于1.3.0或者更高版本，TypeScript中<a href="https://github.com/apache/pulsar-client-node/blob/master/index.d.ts">定义的类型</a>同样可以使用。</p>
<h2><a class="anchor" aria-hidden="true" id="安装"></a><a href="#安装" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>You can install the <a href="https://www.npmjs.com/package/pulsar-client"><code>pulsar-client</code></a> library via <a href="https://www.npmjs.com/">npm</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="要求"></a><a href="#要求" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>要求</h3>
<p>Pulsar Node.js client library is based on the C++ client library. Follow <a href="/docs/zh-CN/2.8.3/client-libraries-cpp#compilation">these instructions</a> and install the Pulsar C++ client library.</p>
<h3><a class="anchor" aria-hidden="true" id="兼容性"></a><a href="#兼容性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h3>
<p>Compatibility between each version of the Node.js client and the C++ client is as follows:</p>
<table>
<thead>
<tr><th style="text-align:left">Node.js 客户端</th><th style="text-align:left">C++ client</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">1.0.0</td><td style="text-align:left">2.3.0 及以上</td></tr>
<tr><td style="text-align:left">1.1.0</td><td style="text-align:left">2.4.0 及以上</td></tr>
<tr><td style="text-align:left">1.2.0</td><td style="text-align:left">2.5.0 及以上</td></tr>
</tbody>
</table>
<p>If an incompatible version of the C++ client is installed, you may fail to build or run this library.</p>
<h3><a class="anchor" aria-hidden="true" id="使用-npm-安装"></a><a href="#使用-npm-安装" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 npm 安装</h3>
<p>Install the <code>pulsar-client</code> library via <a href="https://www.npmjs.com/">npm</a>:</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> npm install pulsar-client</span>
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="note"></a><a href="#note" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note</h4>
<p>因为这个库使用 <a href="https://github.com/nodejs/node-addon-api"><code>node-addon-api</code></a> 模块来包装 C++ 库，因此只能在 Node.js 10.x 或更高版本中运行。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="连接-url"></a><a href="#连接-url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连接 URL</h2>
<p>To connect to Pulsar using client libraries, you need to specify a <a href="/docs/zh-CN/2.8.3/develop-binary-protocol">Pulsar protocol</a> URL.</p>
<p>Pulsar protocol URLs are assigned to specific clusters, use the <code>pulsar</code> scheme and have a default port of 6650. Here is an example for <code>localhost</code>:</p>
<pre><code class="hljs css language-http">pulsar://localhost:6650
</code></pre>
<p>A URL for a production Pulsar cluster may look something like this:</p>
<pre><code class="hljs css language-http">pulsar://pulsar.us-west.example.com:6650
</code></pre>
<p>如果使用<a href="/docs/zh-CN/2.8.3/security-tls-transport">TLS加密</a>或<a href="/docs/zh-CN/2.8.3/security-tls-authentication">TLS认证</a>，URL地址如下：</p>
<pre><code class="hljs css language-http">pulsar+ssl://pulsar.us-west.example.com:6651
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="创建客户端"></a><a href="#创建客户端" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建客户端</h2>
<p>与Pulsar服务端交互之前，需要建立Pulsar客户端。 You can create a client instance using a <code>new</code> operator and the <code>Client</code> method, passing in a client options object (more on configuration <a href="#client-configuration">below</a>).</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="客户端配置"></a><a href="#客户端配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端配置</h3>
<p>The following configurable parameters are available for Pulsar clients:</p>
<table>
<thead>
<tr><th style="text-align:left">参数名</th><th style="text-align:left">说明</th><th style="text-align:left">默认值</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>serviceUrl</code></td><td style="text-align:left">The connection URL for the Pulsar cluster. 更多详细信息，参阅<a href="#connection-urls">这里</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>authentication</code></td><td style="text-align:left">Configure the authentication provider. (default: no authentication). 更多详细信息，参阅 <a href="/docs/zh-CN/2.8.3/security-tls-authentication">TLS 认证</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>operationTimeoutSeconds</code></td><td style="text-align:left">Node.js 客户端操作的超时时间（创建 producer、订阅/取消订阅 <a href="/docs/zh-CN/2.8.3/reference-terminology#topic"> topic</a>）。 未超时时会重试，超时后执行失败</td><td style="text-align:left">30</td></tr>
<tr><td style="text-align:left"><code>ioThreads</code></td><td style="text-align:left">用于处理 Pulsar <a href="/docs/zh-CN/2.8.3/reference-terminology#broker">broker</a> 连接的线程数。</td><td style="text-align:left">1</td></tr>
<tr><td style="text-align:left"><code>messageListenerThreads</code></td><td style="text-align:left"><a href="#consumers">consumer</a> 和 <a href="#readers">readers</a> 监听消息使用的线程数。</td><td style="text-align:left">1</td></tr>
<tr><td style="text-align:left"><code>concurrentLookupRequest</code></td><td style="text-align:left">The number of concurrent lookup requests that can be sent on each broker connection. Setting a maximum helps to keep from overloading brokers. 只有当客户端需要生产及/或订阅数千 Pulsar topic 时，才需要修改预设的默认值：50000 。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>tlsTrustCertsFilePath</code></td><td style="text-align:left">信任的 TLS 证书的文件路径。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>tlsValidateHostname</code></td><td style="text-align:left">设置是否启用 TLS 主机名验证。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>tlsAllowInsecureConnection</code></td><td style="text-align:left">设置是否让 Pulsar 客户端从 broker 接受不信任的 TLS 证书。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>statsIntervalInSeconds</code></td><td style="text-align:left">两次信息统计之间的时间间隔。 当 statsInterval 为正数时启用信息统计。 最小值为 1 秒。</td><td style="text-align:left">600</td></tr>
<tr><td style="text-align:left"><code>log</code></td><td style="text-align:left">记录日志</td><td style="text-align:left"><code>console.log</code></td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="producers"></a><a href="#producers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producers</h2>
<p>Pulsar producers publish messages to Pulsar topics. You can <a href="#producer-configuration">configure</a> Node.js producers using a producer configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>, <span class="hljs-comment">// or 'my-tenant/my-namespace/my-topic' to specify topic's tenant and namespace</span>
});

<span class="hljs-keyword">await</span> producer.send({
  <span class="hljs-attr">data</span>: Buffer.from(<span class="hljs-string">"Hello, Pulsar"</span>),
});

<span class="hljs-keyword">await</span> producer.close();
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="promise-操作"></a><a href="#promise-操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 操作</h4>
<p>When you create a new Pulsar producer, the operation returns <code>Promise</code> object and get producer instance or an error through executor function.<br>
In this example, using await operator instead of executor function.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="producer-operations"></a><a href="#producer-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producer operations</h3>
<p>Pulsar Node.js producers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>send(Object)</code></td><td style="text-align:left">Publishes a <a href="#messages">message</a> to the producer's topic. 当消息被broker成功确认或者出错抛出异常后，Promise对象运行执行器方法，该对象的返回值是消息ID。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>flush()</code></td><td style="text-align:left">将消息从发送队列发送到Pulsar broker。 当消息被broker成功确认或者出错抛出异常后，Promise对象运行执行器方法，该对象的返回值是消息ID。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">Closes the producer and releases all resources allocated to it. <code>close()</code>被调用以后，不再接受来自publisher的消息。 调用后，返回Promise对象。 等所有待发布的请求被持久化到Pulsar后，会运行执行器函数。 如果出错，写操作不会重试。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
<tr><td style="text-align:left"><code>getProducerName()</code></td><td style="text-align:left">获取producer名称的方法</td><td style="text-align:left"><code>string</code></td></tr>
<tr><td style="text-align:left"><code>getTopic()</code></td><td style="text-align:left">获取topic名称的方法</td><td style="text-align:left"><code>string</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="producer-配置"></a><a href="#producer-配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producer 配置</h3>
<table>
<thead>
<tr><th style="text-align:left">参数名</th><th style="text-align:left">说明</th><th style="text-align:left">默认值</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">Pulsar <a href="/docs/zh-CN/2.8.3/reference-terminology#topic">topic</a>接收从producer发送过来的消息。 Topic格式是<code>&lt;topic-name&gt;</code>或者<code>&lt;tenant-name&gt;/&lt;namespace-name&gt;/&lt;topic-name&gt;</code>。 例如：<code>sample/ns1/my-topic</code>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>producerName</code></td><td style="text-align:left">A name for the producer. 如果topic名称没有指定，Pulsar会自动地生成全局唯一的名称。  当明确地给topic指定名称的时候，该名称需要在<em>所有的</em>Pulsar集群中唯一，否则会出错。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>sendTimeoutMs</code></td><td style="text-align:left">Producer发送消息给topic后，会等待存放该消息的Pulsar<a href="/docs/zh-CN/2.8.3/reference-terminology#broker">broker</a>的确认信息。 如果在这个参数设定的阈值内没有确认消息，将抛出错误。 如果将 <code>sendTimeoutMs</code> 设为 -1，那么超时时间将为无穷大(因而移除超时限定)。 Removing the send timeout is recommended when using Pulsar's <a href="/docs/zh-CN/2.8.3/cookbooks-deduplication">message de-duplication</a> feature.</td><td style="text-align:left">30000</td></tr>
<tr><td style="text-align:left"><code>initialSequenceId</code></td><td style="text-align:left">消息的初始序列号 Producer 在发送消息时，将序列号添加到消息中。 只要发送消息，序列号就会相应增加。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>maxPendingMessages</code></td><td style="text-align:left">The maximum size of the queue holding pending messages (i.e. messages waiting to receive an acknowledgment from the <a href="/docs/zh-CN/2.8.3/reference-terminology#broker">broker</a>). 默认情况下，当队列已满时，调用<code>send</code> 方法都会失败，<em>除非</em>将 <code>blockIfQueueFull</code> 设置为 <code>true</code>。</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>maxPendingMessagesAcrossPartitions</code></td><td style="text-align:left">所有分区等待队列空间总和的最大值。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>blockIfQueueFull</code></td><td style="text-align:left">如果参数值设置为 <code>true</code>，当消息传出队列已满时，producer 的 <code>send</code> 方法会进行等待，而不是抛出异常(该队列大小由 <code>maxPendingMessages</code> 参数决定)；如果设置为 <code>false</code> (默认值)，当队列已满时，不能调用 <code>send</code>，并抛出异常。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>messageRoutingMode</code></td><td style="text-align:left">消息路由逻辑（<a href="/docs/zh-CN/2.8.3/concepts-messaging#partitioned-topics">分区 topic</a> 上的 producer 使用）。 This logic is applied only when no key is set on messages. 可以设置为循环（<code>RoundRobinDistribution</code>），或是发布所有消息到单个分区 （<code>UseSinglePartition</code>，默认值）。</td><td style="text-align:left"><code>UseSinglePartition</code></td></tr>
<tr><td style="text-align:left"><code>hashingScheme</code></td><td style="text-align:left">The hashing function that determines the partition on which a particular message is published (partitioned topics only). 可以设置为 <code>JavaStringHash</code>（等同于 Java 中的 <code>String.hashCode()</code>）、<code>Murmur3_32Hash</code>（应用了 <a href="https://en.wikipedia.org/wiki/MurmurHash">Murmur3</a> 散列函数）、或 <code>BoostHash</code> （应用了 C++ 中 <a href="https://www.boost.org/doc/libs/1_62_0/doc/html/hash.html">Boost</a> 库的散列函数）。</td><td style="text-align:left"><code>BoostHash</code></td></tr>
<tr><td style="text-align:left"><code>compressionType</code></td><td style="text-align:left">The message data compression type used by the producer. 可用的选项有：<a href="https://github.com/lz4/lz4"><code>LZ4</code></a>，<a href="https://zlib.net/"><code>Zlib</code></a>，<a href="https://github.com/facebook/zstd/">ZSTD</a>，和<a href="https://github.com/google/snappy/">SNAPPY</a>。</td><td style="text-align:left">Compression None</td></tr>
<tr><td style="text-align:left"><code>batchingEnabled</code></td><td style="text-align:left">如果设置为 <code>true</code>，producer 将批量发送消息。</td><td style="text-align:left"><code>true</code></td></tr>
<tr><td style="text-align:left"><code>batchingMaxPublishDelayMs</code></td><td style="text-align:left">批量发送消息的最大延迟。</td><td style="text-align:left">10</td></tr>
<tr><td style="text-align:left"><code>batchingMaxMessages</code></td><td style="text-align:left">批量发送消息时，消息大小的最大值。</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">Producer 的元数据。</td><td style="text-align:left"></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="生产者示例"></a><a href="#生产者示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生产者示例</h3>
<p>This example creates a Node.js producer for the <code>my-topic</code> topic and sends 10 messages to that topic:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-comment">// Create a producer</span>
  <span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  });

  <span class="hljs-comment">// Send messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-string">`my-message-<span class="hljs-subst">${i}</span>`</span>;
    producer.send({
      <span class="hljs-attr">data</span>: Buffer.from(msg),
    });
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Sent message: <span class="hljs-subst">${msg}</span>`</span>);
  }
  <span class="hljs-keyword">await</span> producer.flush();

  <span class="hljs-keyword">await</span> producer.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="消费者"></a><a href="#消费者" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消费者</h2>
<p>Pulsar consumers subscribe to one or more Pulsar topics and listen for incoming messages produced on that topic/those topics. You can <a href="#consumer-configuration">configure</a> Node.js consumers using a consumer configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  <span class="hljs-attr">subscription</span>: <span class="hljs-string">'my-subscription'</span>,
});

<span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive();
<span class="hljs-built_in">console</span>.log(msg.getData().toString());
consumer.acknowledge(msg);

<span class="hljs-keyword">await</span> consumer.close();
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="promise-操作-1"></a><a href="#promise-操作-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 操作</h4>
<p>When you create a new Pulsar consumer, the operation returns <code>Promise</code> object and get consumer instance or an error through executor function.<br>
In this example, using await operator instead of executor function.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="消费者操作"></a><a href="#消费者操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消费者操作</h3>
<p>Pulsar Node.js consumers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>receive()</code></td><td style="text-align:left">Receives a single message from the topic. 当消息可用时，Promise 对象运行 executor 函数并获取消息对象。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>receive(Number)</code></td><td style="text-align:left">在指定的超时时间（以毫秒为单位）内从 topic 接收单条消息。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>acknowledge(Object)</code></td><td style="text-align:left">通过消息对象向 Pulsar <a href="/docs/zh-CN/2.8.3/reference-terminology#broker">broker</a> <a href="/docs/zh-CN/2.8.3/reference-terminology#acknowledgment-ack">确认收到</a>一条消息。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeId(Object)</code></td><td style="text-align:left">通过消息 ID 向 Pulsar <a href="/docs/zh-CN/2.8.3/reference-terminology#broker">broker</a> <a href="/docs/zh-CN/2.8.3/reference-terminology#acknowledgment-ack">确认收到</a>一条消息。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeCumulative(Object)</code></td><td style="text-align:left"><a href="/docs/zh-CN/2.8.3/reference-terminology#acknowledgment-ack">确认收到</a>流中到指定消息为止的<em>所有</em>消息，包括指定消息。 <code>acknowledgeCumulative</code> 方法返回 void，并向 broker 异步发送确认信息。 此后，这些消息<em>不会</em>重新发送给 consumer。 <a href="/docs/zh-CN/2.8.3/concepts-messaging#shared">共享</a>订阅类型不支持累积确认。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeCumulativeId(Object)</code></td><td style="text-align:left"><a href="/docs/zh-CN/2.8.3/reference-terminology#acknowledgment-ack">确认收到</a>流中到指定消息为止<em>所有</em>消息的 ID，包括指定消息的 ID。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>negativeAcknowledge(Message)</code></td><td style="text-align:left">通过消息对象向 Pulsar broker <a href="/docs/zh-CN/2.8.3/reference-terminology#negative-acknowledgment-nack">确认</a>一条消息有异常。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>negativeAcknowledgeId(MessageId)</code></td><td style="text-align:left">通过消息ID对象向 Pulsar broker <a href="/docs/zh-CN/2.8.3/reference-terminology#negative-acknowledgment-nack">确认</a> 一条消息有异常。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">关闭 consumer，使 consumer 不再从 broker 接收消息。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
<tr><td style="text-align:left"><code>unsubscribe()</code></td><td style="text-align:left">取消订阅</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="consumer-configuration"></a><a href="#consumer-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consumer configuration</h3>
<table>
<thead>
<tr><th style="text-align:left">参数名</th><th style="text-align:left">说明</th><th style="text-align:left">默认值</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">使用Pulsar topic的consumer可以订阅或者监听消息。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>topics</code></td><td style="text-align:left">Topics数组</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>topicsPattern</code></td><td style="text-align:left">Topics的正则表达式</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscription</code></td><td style="text-align:left">Consumer 的订阅名称。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscriptionType</code></td><td style="text-align:left">Available options are <code>Exclusive</code>, <code>Shared</code>, <code>Key_Shared</code>, and <code>Failover</code>.</td><td style="text-align:left"><code>Exclusive</code></td></tr>
<tr><td style="text-align:left"><code>subscriptionInitialPosition</code></td><td style="text-align:left">Initial position at which to set cursor when subscribing to a topic at first time.</td><td style="text-align:left"><code>SubscriptionInitialPosition.Latest</code></td></tr>
<tr><td style="text-align:left"><code>ackTimeoutMs</code></td><td style="text-align:left">消息确认的超时时间（以毫秒为单位）。</td><td style="text-align:left">0</td></tr>
<tr><td style="text-align:left"><code>nAckRedeliverTimeoutMs</code></td><td style="text-align:left">Delay to wait before redelivering messages that failed to be processed.</td><td style="text-align:left">60000</td></tr>
<tr><td style="text-align:left"><code>receiverQueueSize</code></td><td style="text-align:left">设置 consumer 接收队列的大小，即在应用程序调用 <code>receive</code> 之前允许堆积的消息数。 A value higher than the default of 1000 could increase consumer throughput, though at the expense of more memory utilization.</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>receiverQueueSizeAcrossPartitions</code></td><td style="text-align:left">Set the max total receiver queue size across partitions. 当接收队列大小超过此值时，使用该参数减小每个分区接收队列的大小。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>consumerName</code></td><td style="text-align:left">Consumer 的名称。 当前（v2.4.1）版本中， <a href="/docs/zh-CN/2.8.3/concepts-messaging#failover">灾备</a>模式按照 consumer 名称排序。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">Consumer 的元数据。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>listener</code></td><td style="text-align:left">A listener that is called for a message received.</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>readCompacted</code></td><td style="text-align:left">If enabling <code>readCompacted</code>, a consumer reads messages from a compacted topic rather than reading a full message backlog of a topic.<br/><br/>A consumer only sees the latest value for each key in the compacted topic, up until reaching the point in the topic message when compacting backlog. Beyond that point, send messages as normal.<br/><br/> <code>readCompacted</code> can only be enabled on subscriptions to persistent topics, which have a single active consumer (like failure or exclusive subscriptions).<br/><br/>Attempting to enable it on subscriptions to non-persistent topics or on shared subscriptions leads to a subscription call throwing a <code>PulsarClientException</code>.</td><td style="text-align:left">false</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消费者示例"></a><a href="#消费者示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消费者示例</h3>
<p>This example creates a Node.js consumer with the <code>my-subscription</code> subscription on the <code>my-topic</code> topic, receives messages, prints the content that arrive, and acknowledges each message to the Pulsar broker for 10 times:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-comment">// Create a consumer</span>
  <span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
    <span class="hljs-attr">subscription</span>: <span class="hljs-string">'my-subscription'</span>,
    <span class="hljs-attr">subscriptionType</span>: <span class="hljs-string">'Exclusive'</span>,
  });

  <span class="hljs-comment">// Receive messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive();
    <span class="hljs-built_in">console</span>.log(msg.getData().toString());
    consumer.acknowledge(msg);
  }

  <span class="hljs-keyword">await</span> consumer.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<p>Instead a consumer can be created with <code>listener</code> to process messages.</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-comment">// Create a consumer</span>
<span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  <span class="hljs-attr">subscription</span>: <span class="hljs-string">'my-subscription'</span>,
  <span class="hljs-attr">subscriptionType</span>: <span class="hljs-string">'Exclusive'</span>,
  <span class="hljs-attr">listener</span>: <span class="hljs-function">(<span class="hljs-params">msg, msgConsumer</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(msg.getData().toString());
    msgConsumer.acknowledge(msg);
  },
})
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="reader"></a><a href="#reader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader</h2>
<p>Pulsar readers process messages from Pulsar topics. Readers are different from consumers because with readers you need to explicitly specify which message in the stream you want to begin with (consumers, on the other hand, automatically begin with the most recently unacked message). You can <a href="#reader-configuration">configure</a> Node.js readers using a reader configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">await</span> client.createReader({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  <span class="hljs-attr">startMessageId</span>: Pulsar.MessageId.earliest(),
});

<span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> reader.readNext();
<span class="hljs-built_in">console</span>.log(msg.getData().toString());

<span class="hljs-keyword">await</span> reader.close();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="reader-operations"></a><a href="#reader-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader operations</h3>
<p>Pulsar Node.js readers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>readNext()</code></td><td style="text-align:left">接收 topic 中的下一条消息（类似于 consumer 中的 <code>receive</code> 方法）。 当消息可用时，Promise 对象运行 executor 函数并获取消息对象。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>readNext(Number)</code></td><td style="text-align:left">在指定的超时时间（以毫秒为单位）内从 topic 接收单条消息。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>hasNext()</code></td><td style="text-align:left">返回 broker 是否在目标 topic 中存有下一条消息。</td><td style="text-align:left"><code>Boolean</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">关闭 reader，使 reader 不再从 broker 接收消息。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="reader-configuration"></a><a href="#reader-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader configuration</h3>
<table>
<thead>
<tr><th style="text-align:left">参数名</th><th style="text-align:left">说明</th><th style="text-align:left">默认值</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">在Pulsar<a href="/docs/zh-CN/2.8.3/reference-terminology#topic">topic</a>上，用户可以订阅或者监听消息。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>startMessageId</code></td><td style="text-align:left">Reader 的初始位置，即 reader 处理的第一条消息的位置。 可以设置为 <code>Pulsar.MessageId.earliest</code>（topic 中最早的可用消息），或 <code>Pulsar.MessageId.latest</code> （topic 中最新的可用消息），或是任一其他消息 ID。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>receiverQueueSize</code></td><td style="text-align:left">设置 reader 接收队列的大小，即在应用程序调用 <code>readNext</code> 之前允许堆积的消息数。 A value higher than the default of 1000 could increase reader throughput, though at the expense of more memory utilization.</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>readerName</code></td><td style="text-align:left">Reader 的名称。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscriptionRolePrefix</code></td><td style="text-align:left">The subscription role prefix.</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>readCompacted</code></td><td style="text-align:left">If enabling <code>readCompacted</code>, a consumer reads messages from a compacted topic rather than reading a full message backlog of a topic.<br/><br/>A consumer only sees the latest value for each key in the compacted topic, up until reaching the point in the topic message when compacting backlog. Beyond that point, send messages as normal.<br/><br/> <code>readCompacted</code> can only be enabled on subscriptions to persistent topics, which have a single active consumer (like failure or exclusive subscriptions).<br/><br/>Attempting to enable it on subscriptions to non-persistent topics or on shared subscriptions leads to a subscription call throwing a <code>PulsarClientException</code>.</td><td style="text-align:left"><code>false</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="reader-示例"></a><a href="#reader-示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader 示例</h3>
<p>This example creates a Node.js reader with the <code>my-topic</code> topic, reads messages, and prints the content that arrive for 10 times:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
    <span class="hljs-attr">operationTimeoutSeconds</span>: <span class="hljs-number">30</span>,
  });

  <span class="hljs-comment">// Create a reader</span>
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">await</span> client.createReader({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
    <span class="hljs-attr">startMessageId</span>: Pulsar.MessageId.earliest(),
  });

  <span class="hljs-comment">// read messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> reader.readNext();
    <span class="hljs-built_in">console</span>.log(msg.getData().toString());
  }

  <span class="hljs-keyword">await</span> reader.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="消息"></a><a href="#消息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息</h2>
<p>In Pulsar Node.js client, you have to construct producer message object for producer.</p>
<p>Here is an example message:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> msg = {
  <span class="hljs-attr">data</span>: Buffer.from(<span class="hljs-string">'Hello, Pulsar'</span>),
  <span class="hljs-attr">partitionKey</span>: <span class="hljs-string">'key1'</span>,
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-string">'foo'</span>: <span class="hljs-string">'bar'</span>,
  },
  <span class="hljs-attr">eventTimestamp</span>: <span class="hljs-built_in">Date</span>.now(),
  <span class="hljs-attr">replicationClusters</span>: [
    <span class="hljs-string">'cluster1'</span>,
    <span class="hljs-string">'cluster2'</span>,
  ],
}

<span class="hljs-keyword">await</span> producer.send(msg);
</code></pre>
<p>The following keys are available for producer message objects:</p>
<table>
<thead>
<tr><th style="text-align:left">参数名</th><th style="text-align:left">说明</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>data</code></td><td style="text-align:left">消息数据的实际有效负载。</td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">用于存储应用程序指定消息附带的所有元数据。</td></tr>
<tr><td style="text-align:left"><code>eventTimestamp</code></td><td style="text-align:left">与消息相关联的时间戳。</td></tr>
<tr><td style="text-align:left"><code>sequenceId</code></td><td style="text-align:left">消息的序列号。</td></tr>
<tr><td style="text-align:left"><code>partitionKey</code></td><td style="text-align:left">与消息关联的可选键值（对于 topic 压缩等尤其有用）。</td></tr>
<tr><td style="text-align:left"><code>replicationClusters</code></td><td style="text-align:left">使用该参数后，消息会被复制到指定集群。 Pulsar brokers handle message replication automatically; you should only change this setting if you want to override the broker default.</td></tr>
<tr><td style="text-align:left"><code>deliverAt</code></td><td style="text-align:left">延迟消息在确定时间或该时间之后发送</td><td></td></tr>
<tr><td style="text-align:left"><code>deliverAfter</code></td><td style="text-align:left">延迟多久后发送消息</td><td></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消息对象操作"></a><a href="#消息对象操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息对象操作</h3>
<p>In Pulsar Node.js client, you can receive (or read) message object as consumer (or reader).</p>
<p>The message object have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>getTopicName()</code></td><td style="text-align:left">Topic 名称的 Getter 方法。</td><td style="text-align:left"><code>String</code></td></tr>
<tr><td style="text-align:left"><code>getProperties()</code></td><td style="text-align:left">属性的 Getter 方法。</td><td style="text-align:left"><code>数组&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>getData()</code></td><td style="text-align:left">消息数据的 Getter方法。</td><td style="text-align:left"><code>Buffer</code></td></tr>
<tr><td style="text-align:left"><code>getMessageId()</code></td><td style="text-align:left"><a href="#message-id-object-operations">消息 id 对象</a>的 Getter 方法。</td><td style="text-align:left"><code>对象</code></td></tr>
<tr><td style="text-align:left"><code>getPublishTimestamp()</code></td><td style="text-align:left">发布时间戳的 Getter 方法。</td><td style="text-align:left"><code>数值</code></td></tr>
<tr><td style="text-align:left"><code>getEventTimestamp()</code></td><td style="text-align:left">事件时间戳的 Getter 方法。</td><td style="text-align:left"><code>数值</code></td></tr>
<tr><td style="text-align:left"><code>getRedeliveryCount()</code></td><td style="text-align:left">获取重新投递数量的Getter方法</td><td style="text-align:left"><code>数值</code></td></tr>
<tr><td style="text-align:left"><code>getPartitionKey()</code></td><td style="text-align:left">分区键的 Getter 方法。</td><td style="text-align:left"><code>String</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消息-id-对象操作"></a><a href="#消息-id-对象操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息 ID 对象操作</h3>
<p>In Pulsar Node.js client, you can get message id object from message object.</p>
<p>The message id object have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>serialize()</code></td><td style="text-align:left">序列化消息 id 到缓存中进行存储。</td><td style="text-align:left"><code>Buffer</code></td></tr>
<tr><td style="text-align:left"><code>toString()</code></td><td style="text-align:left">获取消息 id 字符串。</td><td style="text-align:left"><code>String</code></td></tr>
</tbody>
</table>
<p>The client has static method of message id object. You can access it as <code>Pulsar.MessageId.someStaticMethod</code> too.</p>
<p>The following static methods are available for the message id object:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">说明</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>earliest()</code></td><td style="text-align:left">MessageId 表示存储在 topic 中最早/最旧的可用消息。</td><td style="text-align:left"><code>对象</code></td></tr>
<tr><td style="text-align:left"><code>latest()</code></td><td style="text-align:left">MessageId 表示存储在 topic 中最晚/最新的可用消息。</td><td style="text-align:left"><code>对象</code></td></tr>
<tr><td style="text-align:left"><code>deserialize(Buffer)</code></td><td style="text-align:left">从缓存中反序列化出消息 id。</td><td style="text-align:left"><code>对象</code></td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="端到端加密"></a><a href="#端到端加密" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>端到端加密</h2>
<p><a href="https://pulsar.apache.org/docs/en/next/cookbooks-encryption/#docsNav">End-to-end encryption</a> allows applications to encrypt messages at producers and decrypt at consumers.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>如果想在Node.js客户端配置端到端加密功能，那么需要在producer端和consumer端都配置<code>publicKeyPath</code>和<code>privateKeyPath</code>。</p>
<pre><code class="hljs"><span class="hljs-symbol">publicKeyPath:</span> <span class="hljs-string">"./public.pem"</span>
<span class="hljs-symbol">privateKeyPath:</span> <span class="hljs-string">"./private.pem"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="教程"></a><a href="#教程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>教程</h3>
<p>本节提供详细步骤，说明在 Node.js客户端中如何使用端到端加密功能。</p>
<p><strong>前提条件</strong></p>
<ul>
<li>Pulsar C++ 客户端版本为2.7.1或者更高</li>
</ul>
<p><strong>步骤</strong></p>
<ol>
<li><p>创建公钥和私钥密钥对。</p>
<p><strong>输入</strong></p>
<pre><code class="hljs css language-shell">openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem
</code></pre></li>
<li><p>创建一个生产者用来发送加密消息。</p>
<p><strong>输入</strong></p>
<pre><code class="hljs css language-nodejs"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client(<span class="hljs-params">{
    serviceUrl: 'pulsar:<span class="hljs-comment">//localhost:6650',</span>
    operationTimeoutSeconds: 30,
  }</span>);

  <span class="hljs-comment">// Create a producer</span>
  <span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer(<span class="hljs-params">{
    topic: 'persistent:<span class="hljs-comment">//public/default/my-topic',</span>
    sendTimeoutMs: 30000,
    batchingEnabled: <span class="hljs-literal">true</span>,
    publicKeyPath: "./<span class="hljs-keyword">public</span>.pem",
    privateKeyPath: "./<span class="hljs-keyword">private</span>.pem",
    encryptionKey: "encryption-key"
  }</span>);

  <span class="hljs-built_in">console</span>.log(<span class="hljs-params">producer.ProducerConfig</span>)
  <span class="hljs-comment">// Send messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-params"><span class="hljs-keyword">let</span> i = 0; i &lt; 10; i += 1</span>) {
    <span class="hljs-keyword">const</span> msg = `my-message-${i}`;
    producer.send(<span class="hljs-params">{
      data: Buffer.<span class="hljs-keyword">from</span>(<span class="hljs-params">msg</span>),
    }</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">`Sent message: ${msg}`</span>);
  }
  <span class="hljs-keyword">await</span> producer.flush(<span class="hljs-params"></span>);

  <span class="hljs-keyword">await</span> producer.close(<span class="hljs-params"></span>);
  <span class="hljs-keyword">await</span> client.close(<span class="hljs-params"></span>);
}</span>)<span class="hljs-params">()</span>;
</span></code></pre></li>
<li><p>创建消费者接收加密消息。</p>
<p><strong>输入</strong></p>
<pre><code class="hljs css language-nodejs"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client(<span class="hljs-params">{
    serviceUrl: 'pulsar:<span class="hljs-comment">//172.25.0.3:6650',</span>
    operationTimeoutSeconds: 30
  }</span>);

  <span class="hljs-comment">// Create a consumer</span>
  <span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe(<span class="hljs-params">{
    topic: 'persistent:<span class="hljs-comment">//public/default/my-topic',</span>
    subscription: 'sub1',
    subscriptionType: 'Shared',
    ackTimeoutMs: 10000,
    publicKeyPath: "./<span class="hljs-keyword">public</span>.pem",
    privateKeyPath: "./<span class="hljs-keyword">private</span>.pem"
  }</span>);

  <span class="hljs-built_in">console</span>.log(<span class="hljs-params">consumer</span>)
  <span class="hljs-comment">// Receive messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-params"><span class="hljs-keyword">let</span> i = 0; i &lt; 10; i += 1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive(<span class="hljs-params"></span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">msg.getData(<span class="hljs-params"></span>).toString(<span class="hljs-params"></span>)</span>);
    consumer.acknowledge(<span class="hljs-params">msg</span>);
  }

  <span class="hljs-keyword">await</span> consumer.close(<span class="hljs-params"></span>);
  <span class="hljs-keyword">await</span> client.close(<span class="hljs-params"></span>);
}</span>)<span class="hljs-params">()</span>;
</span></code></pre></li>
<li><p>运行消费者接收加密消息。</p>
<p><strong>输入</strong></p>
<pre><code class="hljs css language-shell">node consumer.js
</code></pre></li>
<li><p>在一个新的终端窗口中，运行生产者来生成加密消息。</p>
<p><strong>输入</strong></p>
<pre><code class="hljs css language-shell">node producer.js
</code></pre>
<p>现在你可以看到生产者发送消息，消费者成功收到消息。</p>
<p><strong>输出</strong></p>
<p>生产端：</p>
<pre><code class="hljs">Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">0</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">1</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">2</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">3</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">4</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">5</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">6</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">7</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">8</span>
Sent <span class="hljs-keyword">message</span>: my-<span class="hljs-keyword">message</span>-<span class="hljs-number">9</span>
</code></pre>
<p>消费端：</p>
<pre><code class="hljs">my-message<span class="hljs-number">-0</span>
my-message<span class="hljs-number">-1</span>
my-message<span class="hljs-number">-2</span>
my-message<span class="hljs-number">-3</span>
my-message<span class="hljs-number">-4</span>
my-message<span class="hljs-number">-5</span>
my-message<span class="hljs-number">-6</span>
my-message<span class="hljs-number">-7</span>
my-message<span class="hljs-number">-8</span>
my-message<span class="hljs-number">-9</span>
</code></pre></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/2.8.3/client-libraries-cpp"><span class="arrow-prev">← </span><span>C++</span></a><a class="docs-next button" href="/docs/zh-CN/2.8.3/client-libraries-websocket"><span class="function-name-prevnext">WebSocket</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#安装">安装</a><ul class="toc-headings"><li><a href="#要求">要求</a></li><li><a href="#兼容性">兼容性</a></li><li><a href="#使用-npm-安装">使用 npm 安装</a></li></ul></li><li><a href="#连接-url">连接 URL</a></li><li><a href="#创建客户端">创建客户端</a><ul class="toc-headings"><li><a href="#客户端配置">客户端配置</a></li></ul></li><li><a href="#producers">Producers</a><ul class="toc-headings"><li><a href="#producer-operations">Producer operations</a></li><li><a href="#producer-配置">Producer 配置</a></li><li><a href="#生产者示例">生产者示例</a></li></ul></li><li><a href="#消费者">消费者</a><ul class="toc-headings"><li><a href="#消费者操作">消费者操作</a></li><li><a href="#consumer-configuration">Consumer configuration</a></li><li><a href="#消费者示例">消费者示例</a></li></ul></li><li><a href="#reader">Reader</a><ul class="toc-headings"><li><a href="#reader-operations">Reader operations</a></li><li><a href="#reader-configuration">Reader configuration</a></li><li><a href="#reader-示例">Reader 示例</a></li></ul></li><li><a href="#消息">消息</a><ul class="toc-headings"><li><a href="#消息对象操作">消息对象操作</a></li><li><a href="#消息-id-对象操作">消息 ID 对象操作</a></li></ul></li><li><a href="#端到端加密">端到端加密</a><ul class="toc-headings"><li><a href="#configuration">Configuration</a></li><li><a href="#教程">教程</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/zh-CN/contact">Contact</a></li>' +
            '<li><a href="/zh-CN/contributing">Contributing</a></li>' +
            '<li><a href="/zh-CN/coding-guide">Coding guide</a></li>' +
            '<li><a href="/zh-CN/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/zh-CN/resources">Resources</a></li>' +
            '<li><a href="/zh-CN/team">Team</a></li>' +
            '<li><a href="/zh-CN/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN","version:2.8.3"]}
              });
            </script></body></html>